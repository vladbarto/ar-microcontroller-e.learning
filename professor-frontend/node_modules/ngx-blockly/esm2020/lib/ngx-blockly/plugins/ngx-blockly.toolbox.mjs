import { UUID } from 'angular2-uuid';
import * as Blockly from 'blockly/core';
export class NgxBlocklyToolbox extends Blockly.Toolbox {
    constructor(workspace) {
        super(workspace);
        this.SEARCH_CATEGORY = 'SEARCH_CATEGORY';
        this.SEARCH_PLACEHOLDER = 'SEARCH_PLACEHOLDER';
        this._SEARCHBAR_CLASS = 'searchbar';
        this._TOOLBAR_CLASS = 'toolbar';
        this._categoryId = UUID.UUID();
        this._categoryExpandedCache = new Map();
        workspace.addChangeListener(this._onWorkspaceChange.bind(this));
    }
    init() {
        super.init();
        this._initSearchbar();
    }
    render(parsedToolboxDef) {
        if (parsedToolboxDef.contents.length === 0 || parsedToolboxDef.contents[0].toolboxitemid !== this._categoryId) {
            const name = Blockly.Msg[this.SEARCH_CATEGORY] ? Blockly.Msg[this.SEARCH_CATEGORY] : 'Search';
            const xmlDef = '<xml>' +
                '<category colour="#ccc" expanded="false" name="' + name + '" hidden="true" toolboxitemid="' + this._categoryId + '"></category>' +
                '</xml>';
            const jsonDef = Blockly.utils.toolbox.convertToolboxDefToJson(xmlDef);
            parsedToolboxDef.contents = [jsonDef.contents[0]].concat(parsedToolboxDef.contents);
        }
        super.render(parsedToolboxDef);
        this._restoreExpandedState();
    }
    clearSearch() {
        this._clearSearchResult();
        if (this._input) {
            this._input.value = '';
        }
    }
    toXML() {
        let xml = '<xml id="toolbox" style="display: none">';
        if (this._nodes) {
            for (const node of this._nodes) {
                xml += node.toXML();
            }
        }
        xml += '</xml>';
        return xml;
    }
    get nodes() {
        return this._nodes;
    }
    set nodes(nodes) {
        this._nodes = nodes;
    }
    _initSearchbar() {
        this._input = document.createElement('input');
        this._input.placeholder = Blockly.Msg[this.SEARCH_PLACEHOLDER] ? Blockly.Msg[this.SEARCH_PLACEHOLDER] : 'search';
        this._input.className = this._SEARCHBAR_CLASS;
        this._input.size = 1;
        this._input.addEventListener('keyup', this._search.bind(this));
        const element = this.HtmlDiv.firstChild;
        element.classList.add(this._TOOLBAR_CLASS);
        this.HtmlDiv.insertBefore(this._input, element);
    }
    _search(event) {
        clearTimeout(this._timeout);
        this._timeout = setTimeout(() => {
            const searchKey = event.target.value.trim();
            if (searchKey.length > 0) {
                const result = this._recursiveSearch(searchKey, this.toolboxDef_);
                if (result.length > 0) {
                    const category = this.getToolboxItemById(this._categoryId);
                    category.updateFlyoutContents(result);
                    category.show();
                    this.setSelectedItem(category);
                }
                else {
                    this._clearSearchResult();
                }
            }
            else {
                this._clearSearchResult();
            }
        }, 100);
    }
    _recursiveSearch(searchKey, child) {
        let blockDefs = [];
        if (child.contents && Array.isArray(child.contents)) {
            if (child.toolboxitemid && child.toolboxitemid === this._categoryId) {
                return blockDefs;
            }
            for (let i = 0; i < child.contents.length; i++) {
                if (typeof (child.contents[i]) === 'object' && child.contents[i].kind) {
                    if (child.contents[i].kind === 'BLOCK' && child.contents[i].type) {
                        const type = child.contents[i].type;
                        if (this._compare(searchKey, type)) {
                            blockDefs.push(child.contents[i]);
                        }
                        else {
                            const workspace = new Blockly.Workspace();
                            const searchBlock = workspace.newBlock(type);
                            if (this._compare(searchKey, searchBlock.tooltip.toString())) {
                                blockDefs.push(child.contents[i]);
                            }
                            workspace.dispose();
                        }
                    }
                    else if (child.contents[i].kind === 'CATEGORY') {
                        const result = this._recursiveSearch(searchKey, child.contents[i]);
                        blockDefs = [...blockDefs, ...result];
                    }
                }
            }
        }
        return blockDefs;
    }
    _clearSearchResult() {
        const flyout = this.workspace_.getFlyout();
        if (flyout) {
            flyout.hide();
        }
        const category = this.getToolboxItemById(this._categoryId);
        if (category) {
            category.hide();
        }
    }
    _storeExpandedState() {
        this.getToolboxItems().forEach(item => {
            if (item.getId() !== this._categoryId) {
                const collapsibleItem = item;
                if (typeof collapsibleItem.isExpanded === 'function') {
                    this._categoryExpandedCache.set(collapsibleItem.getId(), collapsibleItem.isExpanded());
                }
            }
        });
    }
    _restoreExpandedState() {
        this._categoryExpandedCache.forEach((expanded, id) => {
            const collapsibleItem = this.getToolboxItemById(id);
            if (collapsibleItem && typeof collapsibleItem.isExpanded === 'function') {
                this._categoryExpandedCache.set(collapsibleItem.getId(), collapsibleItem.isExpanded());
            }
        });
    }
    _onWorkspaceChange(event) {
        if (event.type === Blockly.Events.TOOLBOX_ITEM_SELECT) {
            this._storeExpandedState();
        }
    }
    _compare(str1, str2) {
        if (typeof str1 === 'string' && typeof str2 === 'string') {
            str1 = this._prepareString(str1);
            str2 = this._prepareString(str2);
            if (str1.length > 0 && str2.length > 0) {
                const array1 = str1.split('_');
                const array2 = str2.split('_');
                for (let i1 = 0; i1 < array1.length; i1++) {
                    for (let i2 = 0; i2 < array2.length; i2++) {
                        if (array2[i2].startsWith(array1[i1])) {
                            return true;
                        }
                    }
                }
            }
        }
        return false;
    }
    _prepareString(str) {
        str = this._breakUpCamelCase(str);
        str = str.toLowerCase().trim();
        return this._replaceWhitespaceWithUnderscore(str);
    }
    _breakUpCamelCase(str) {
        return str.replace(/([A-Z])/g, ' $1');
    }
    _replaceWhitespaceWithUnderscore(str) {
        return str.replace(/\s+/g, '_');
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibmd4LWJsb2NrbHkudG9vbGJveC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uL3Byb2plY3RzL25neC1ibG9ja2x5L3NyYy9saWIvbmd4LWJsb2NrbHkvcGx1Z2lucy9uZ3gtYmxvY2tseS50b29sYm94LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxJQUFJLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDckMsT0FBTyxLQUFLLE9BQU8sTUFBTSxjQUFjLENBQUM7QUFJeEMsTUFBTSxPQUFPLGlCQUFrQixTQUFRLE9BQU8sQ0FBQyxPQUFPO0lBYWxELFlBQVksU0FBK0I7UUFDdkMsS0FBSyxDQUFDLFNBQVMsQ0FBQyxDQUFDO1FBWkwsb0JBQWUsR0FBRyxpQkFBaUIsQ0FBQztRQUNwQyx1QkFBa0IsR0FBRyxvQkFBb0IsQ0FBQztRQUN6QyxxQkFBZ0IsR0FBRyxXQUFXLENBQUM7UUFDL0IsbUJBQWMsR0FBRyxTQUFTLENBQUM7UUFJbEMsZ0JBQVcsR0FBRyxJQUFJLENBQUMsSUFBSSxFQUFFLENBQUM7UUFDMUIsMkJBQXNCLEdBQXlCLElBQUksR0FBRyxFQUFtQixDQUFDO1FBS2hGLFNBQVMsQ0FBQyxpQkFBaUIsQ0FBQyxJQUFJLENBQUMsa0JBQWtCLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUM7SUFDcEUsQ0FBQztJQUVNLElBQUk7UUFDUCxLQUFLLENBQUMsSUFBSSxFQUFFLENBQUM7UUFDYixJQUFJLENBQUMsY0FBYyxFQUFFLENBQUM7SUFDMUIsQ0FBQztJQUVNLE1BQU0sQ0FBQyxnQkFBZ0I7UUFDMUIsSUFBSSxnQkFBZ0IsQ0FBQyxRQUFRLENBQUMsTUFBTSxLQUFLLENBQUMsSUFBSSxnQkFBZ0IsQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLENBQUMsYUFBYSxLQUFLLElBQUksQ0FBQyxXQUFXLEVBQUU7WUFDM0csTUFBTSxJQUFJLEdBQUcsT0FBTyxDQUFDLEdBQUcs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QixHQUFHLEdBQUcsSUFBSSxDQUFDLGlCQUFpQixDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBQ2xDLEdBQUcsR0FBRyxHQUFHLENBQUMsV0FBVyxFQUFFLENBQUMsSUFBSSxFQUFFLENBQUM7UUFDL0IsT0FBTyxJQUFJLENBQUMsZ0NBQWdDLENBQUMsR0FBRyxDQUFDLENBQUM7SUFDdEQsQ0FBQztJQUVPLGlCQUFpQixDQUFDLEdBQUc7UUFDekIsT0FBTyxHQUFHLENBQUMsT0FBTyxDQUFDLFVBQVUsRUFBRSxLQUFLLENBQUMsQ0FBQztJQUMxQyxDQUFDO0lBRU8sZ0NBQWdDLENBQUMsR0FBRztRQUN4QyxPQUFPLEdBQUcsQ0FBQyxPQUFPLENBQUMsTUFBTSxFQUFFLEdBQUcsQ0FBQyxDQUFDO0lBQ3BDLENBQUM7Q0FDSiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFVVSUQgfSBmcm9tICdhbmd1bGFyMi11dWlkJztcbmltcG9ydCAqIGFzIEJsb2NrbHkgZnJvbSAnYmxvY2tseS9jb3JlJztcbmltcG9ydCB7IElDb2xsYXBzaWJsZVRvb2xib3hJdGVtLCBUb29sYm94Q2F0ZWdvcnkgfSBmcm9tICdibG9ja2x5L2Jsb2NrbHknO1xuaW1wb3J0IHsgTm9kZSB9IGZyb20gJy4uL21vZGVscy9ub2RlJztcblxuZXhwb3J0IGNsYXNzIE5neEJsb2NrbHlUb29sYm94IGV4dGVuZHMgQmxvY2tseS5Ub29sYm94IHtcblxuICAgIHB1YmxpYyByZWFkb25seSBTRUFSQ0hfQ0FURUdPUlkgPSAnU0VBUkNIX0NBVEVHT1JZJztcbiAgICBwdWJsaWMgcmVhZG9ubHkgU0VBUkNIX1BMQUNFSE9MREVSID0gJ1NFQVJDSF9QTEFDRUhPTERFUic7XG4gICAgcHJpdmF0ZSByZWFkb25seSBfU0VBUkNIQkFSX0NMQVNTID0gJ3NlYXJjaGJhcic7XG4gICAgcHJpdmF0ZSByZWFkb25seSBfVE9PTEJBUl9DTEFTUyA9ICd0b29sYmFyJztcblxuICAgIHByb3RlY3RlZCBfdGltZW91dDogYW55O1xuICAgIHByb3RlY3RlZCBfaW5wdXQ6IEhUTUxJbnB1dEVsZW1lbnQ7XG4gICAgcHJvdGVjdGVkIF9jYXRlZ29yeUlkID0gVVVJRC5VVUlEKCk7XG4gICAgcHJvdGVjdGVkIF9jYXRlZ29yeUV4cGFuZGVkQ2FjaGU6IE1hcDxTdHJpbmcsIGJvb2xlYW4+ID0gbmV3IE1hcDxTdHJpbmcsIGJvb2xlYW4+KCk7XG4gICAgcHJpdmF0ZSBfbm9kZXM6IE5vZGVbXTtcblxuICAgIGNvbnN0cnVjdG9yKHdvcmtzcGFjZTogQmxvY2tseS5Xb3Jrc3BhY2VTdmcpIHtcbiAgICAgICAgc3VwZXIod29ya3NwYWNlKTtcbiAgICAgICAgd29ya3NwYWNlLmFkZENoYW5nZUxpc3RlbmVyKHRoaXMuX29uV29ya3NwYWNlQ2hhbmdlLmJpbmQodGhpcykpO1xuICAgIH1cblxuICAgIHB1YmxpYyBpbml0KCkge1xuICAgICAgICBzdXBlci5pbml0KCk7XG4gICAgICAgIHRoaXMuX2luaXRTZWFyY2hiYXIoKTtcbiAgICB9XG5cbiAgICBwdWJsaWMgcmVuZGVyKHBhcnNlZFRvb2xib3hEZWYpIHtcbiAgICAgICAgaWYgKHBhcnNlZFRvb2xib3hEZWYuY29udGVudHMubGVuZ3RoID09PSAwIHx8IHBhcnNlZFRvb2xib3hEZWYuY29udGVudHNbMF0udG9vbGJveGl0ZW1pZCAhPT0gdGhpcy5fY2F0ZWdvcnlJZCkge1xuICAgICAgICAgICAgY29uc3QgbmFtZSA9IEJsb2NrbHkuTXNnW3RoaXMuU0VBUkNIX0NBVEVHT1JZXSA/IEJsb2NrbHkuTXNnW3RoaXMuU0VBUkNIX0NBVEVHT1JZXSA6ICdTZWFyY2gnO1xuICAgICAgICAgICAgY29uc3QgeG1sRGVmID1cbiAgICAgICAgICAgICAgICAnPHhtbD4nICtcbiAgICAgICAgICAgICAgICAnPGNhdGVnb3J5IGNvbG91cj1cIiNjY2NcIiBleHBhbmRlZD1cImZhbHNlXCIgbmFtZT1cIicgKyBuYW1lICsgJ1wiIGhpZGRlbj1cInRydWVcIiB0b29sYm94aXRlbWlkPVwiJyArIHRoaXMuX2NhdGVnb3J5SWQgKyAnXCI+PC9jYXRlZ29yeT4nICtcbiAgICAgICAgICAgICAgICAnPC94bWw+JztcbiAgICAgICAgICAgIGNvbnN0IGpzb25EZWYgPSBCbG9ja2x5LnV0aWxzLnRvb2xib3guY29udmVydFRvb2xib3hEZWZUb0pzb24oeG1sRGVmKTtcbiAgICAgICAgICAgIHBhcnNlZFRvb2xib3hEZWYuY29udGVudHMgPSBbanNvbkRlZi5jb250ZW50c1swXV0uY29uY2F0KHBhcnNlZFRvb2xib3hEZWYuY29udGVudHMpO1xuICAgICAgICB9XG4gICAgICAgIHN1cGVyLnJlbmRlcihwYXJzZWRUb29sYm94RGVmKTtcbiAgICAgICAgdGhpcy5fcmVzdG9yZUV4cGFuZGVkU3RhdGUoKTtcbiAgICB9XG5cbiAgICBwdWJsaWMgY2xlYXJTZWFyY2goKSB7XG4gICAgICAgIHRoaXMuX2NsZWFyU2VhcmNoUmVzdWx0KCk7XG4gICAgICAgIGlmICh0aGlzLl9pbnB1dCkge1xuICAgICAgICAgICAgdGhpcy5faW5wdXQudmFsdWUgPSAnJztcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHB1YmxpYyB0b1hNTCgpOiBzdHJpbmcge1xuICAgICAgICBsZXQgeG1sID0gJzx4bWwgaWQ9XCJ0b29sYm94XCIgc3R5bGU9XCJkaXNwbGF5OiBub25lXCI+JztcbiAgICAgICAgaWYgKHRoaXMuX25vZGVzKSB7XG4gICAgICAgICAgICBmb3IgKGNvbnN0IG5vZGUgb2YgdGhpcy5fbm9kZXMpIHtcbiAgICAgICAgICAgICAgICB4bWwgKz0gbm9kZS50b1hNTCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHhtbCArPSAnPC94bWw+JztcbiAgICAgICAgcmV0dXJuIHhtbDtcbiAgICB9XG5cbiAgICBnZXQgbm9kZXMoKTogTm9kZVtdIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX25vZGVzO1xuICAgIH1cblxuICAgIHNldCBub2Rlcyhub2RlczogTm9kZVtdKSB7XG4gICAgICAgIHRoaXMuX25vZGVzID0gbm9kZXM7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBfaW5pdFNlYXJjaGJhcigpIHtcbiAgICAgICAgdGhpcy5faW5wdXQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpbnB1dCcpO1xuICAgICAgICB0aGlzLl9pbnB1dC5wbGFjZWhvbGRlciA9IEJsb2NrbHkuTXNnW3RoaXMuU0VBUkNIX1BMQUNFSE9MREVSXSA/IEJsb2NrbHkuTXNnW3RoaXMuU0VBUkNIX1BMQUNFSE9MREVSXSA6ICdzZWFyY2gnO1xuICAgICAgICB0aGlzLl9pbnB1dC5jbGFzc05hbWUgPSB0aGlzLl9TRUFSQ0hCQVJfQ0xBU1M7XG4gICAgICAgIHRoaXMuX2lucHV0LnNpemUgPSAxO1xuICAgICAgICB0aGlzLl9pbnB1dC5hZGRFdmVudExpc3RlbmVyKCdrZXl1cCcsIHRoaXMuX3NlYXJjaC5iaW5kKHRoaXMpKTtcbiAgICAgICAgY29uc3QgZWxlbWVudCA9IHRoaXMuSHRtbERpdi5maXJzdENoaWxkIGFzIEhUTUxFbGVtZW50O1xuICAgICAgICBlbGVtZW50LmNsYXNzTGlzdC5hZGQodGhpcy5fVE9PTEJBUl9DTEFTUyk7XG4gICAgICAgIHRoaXMuSHRtbERpdi5pbnNlcnRCZWZvcmUodGhpcy5faW5wdXQsIGVsZW1lbnQpO1xuICAgIH1cblxuICAgIHByaXZhdGUgX3NlYXJjaChldmVudCkge1xuXG4gICAgICAgIGNsZWFyVGltZW91dCh0aGlzLl90aW1lb3V0KTtcbiAgICAgICAgdGhpcy5fdGltZW91dCA9IHNldFRpbWVvdXQoKCkgPT4ge1xuXG4gICAgICAgICAgICBjb25zdCBzZWFyY2hLZXkgPSBldmVudC50YXJnZXQudmFsdWUudHJpbSgpO1xuICAgICAgICAgICAgaWYgKHNlYXJjaEtleS5sZW5ndGggPiAwKSB7XG5cbiAgICAgICAgICAgICAgICBjb25zdCByZXN1bHQgPSB0aGlzLl9yZWN1cnNpdmVTZWFyY2goc2VhcmNoS2V5LCB0aGlzLnRvb2xib3hEZWZfKTtcbiAgICAgICAgICAgICAgICBpZiAocmVzdWx0Lmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgY2F0ZWdvcnkgPSB0aGlzLmdldFRvb2xib3hJdGVtQnlJZCh0aGlzLl9jYXRlZ29yeUlkKSBhcyBUb29sYm94Q2F0ZWdvcnk7XG4gICAgICAgICAgICAgICAgICAgIGNhdGVnb3J5LnVwZGF0ZUZseW91dENvbnRlbnRzKHJlc3VsdCk7XG4gICAgICAgICAgICAgICAgICAgIGNhdGVnb3J5LnNob3coKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXRTZWxlY3RlZEl0ZW0oY2F0ZWdvcnkpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX2NsZWFyU2VhcmNoUmVzdWx0KCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9jbGVhclNlYXJjaFJlc3VsdCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LCAxMDApO1xuICAgIH1cblxuICAgIHByaXZhdGUgX3JlY3Vyc2l2ZVNlYXJjaChzZWFyY2hLZXksIGNoaWxkKTogYW55W10ge1xuICAgICAgICBsZXQgYmxvY2tEZWZzID0gW107XG4gICAgICAgIGlmIChjaGlsZC5jb250ZW50cyAmJiBBcnJheS5pc0FycmF5KGNoaWxkLmNvbnRlbnRzKSkge1xuICAgICAgICAgICAgaWYgKGNoaWxkLnRvb2xib3hpdGVtaWQgJiYgY2hpbGQudG9vbGJveGl0ZW1pZCA9PT0gdGhpcy5fY2F0ZWdvcnlJZCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBibG9ja0RlZnM7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGNoaWxkLmNvbnRlbnRzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgaWYgKHR5cGVvZiAoY2hpbGQuY29udGVudHNbaV0pID09PSAnb2JqZWN0JyAmJiBjaGlsZC5jb250ZW50c1tpXS5raW5kKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChjaGlsZC5jb250ZW50c1tpXS5raW5kID09PSAnQkxPQ0snICYmIGNoaWxkLmNvbnRlbnRzW2ldLnR5cGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHR5cGUgPSBjaGlsZC5jb250ZW50c1tpXS50eXBlO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuX2NvbXBhcmUoc2VhcmNoS2V5LCB0eXBlKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJsb2NrRGVmcy5wdXNoKGNoaWxkLmNvbnRlbnRzW2ldKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgd29ya3NwYWNlID0gbmV3IEJsb2NrbHkuV29ya3NwYWNlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgc2VhcmNoQmxvY2sgPSB3b3Jrc3BhY2UubmV3QmxvY2sodHlwZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuX2NvbXBhcmUoc2VhcmNoS2V5LCBzZWFyY2hCbG9jay50b29sdGlwLnRvU3RyaW5nKCkpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJsb2NrRGVmcy5wdXNoKGNoaWxkLmNvbnRlbnRzW2ldKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgd29ya3NwYWNlLmRpc3Bvc2UoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChjaGlsZC5jb250ZW50c1tpXS5raW5kID09PSAnQ0FURUdPUlknKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCByZXN1bHQgPSB0aGlzLl9yZWN1cnNpdmVTZWFyY2goc2VhcmNoS2V5LCBjaGlsZC5jb250ZW50c1tpXSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBibG9ja0RlZnMgPSBbLi4uYmxvY2tEZWZzLCAuLi5yZXN1bHRdO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBibG9ja0RlZnM7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBfY2xlYXJTZWFyY2hSZXN1bHQoKSB7XG4gICAgICAgIGNvbnN0IGZseW91dCA9IHRoaXMud29ya3NwYWNlXy5nZXRGbHlvdXQoKTtcbiAgICAgICAgaWYgKGZseW91dCkge1xuICAgICAgICAgICAgZmx5b3V0LmhpZGUoKTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBjYXRlZ29yeTogVG9vbGJveENhdGVnb3J5ID0gdGhpcy5nZXRUb29sYm94SXRlbUJ5SWQodGhpcy5fY2F0ZWdvcnlJZCkgYXMgVG9vbGJveENhdGVnb3J5O1xuICAgICAgICBpZiAoY2F0ZWdvcnkpIHtcbiAgICAgICAgICAgIGNhdGVnb3J5LmhpZGUoKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHByaXZhdGUgX3N0b3JlRXhwYW5kZWRTdGF0ZSgpIHtcbiAgICAgICAgdGhpcy5nZXRUb29sYm94SXRlbXMoKS5mb3JFYWNoKGl0ZW0gPT4ge1xuICAgICAgICAgICAgaWYgKGl0ZW0uZ2V0SWQoKSAhPT0gdGhpcy5fY2F0ZWdvcnlJZCkge1xuICAgICAgICAgICAgICAgIGNvbnN0IGNvbGxhcHNpYmxlSXRlbSA9IGl0ZW0gYXMgSUNvbGxhcHNpYmxlVG9vbGJveEl0ZW07XG4gICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBjb2xsYXBzaWJsZUl0ZW0uaXNFeHBhbmRlZCA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl9jYXRlZ29yeUV4cGFuZGVkQ2FjaGUuc2V0KGNvbGxhcHNpYmxlSXRlbS5nZXRJZCgpLCBjb2xsYXBzaWJsZUl0ZW0uaXNFeHBhbmRlZCgpKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIHByaXZhdGUgX3Jlc3RvcmVFeHBhbmRlZFN0YXRlKCkge1xuICAgICAgICB0aGlzLl9jYXRlZ29yeUV4cGFuZGVkQ2FjaGUuZm9yRWFjaCgoZXhwYW5kZWQ6IGJvb2xlYW4sIGlkOiBzdHJpbmcpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGNvbGxhcHNpYmxlSXRlbSA9IHRoaXMuZ2V0VG9vbGJveEl0ZW1CeUlkKGlkKSBhcyBJQ29sbGFwc2libGVUb29sYm94SXRlbTtcbiAgICAgICAgICAgIGlmIChjb2xsYXBzaWJsZUl0ZW0gJiYgdHlwZW9mIGNvbGxhcHNpYmxlSXRlbS5pc0V4cGFuZGVkID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fY2F0ZWdvcnlFeHBhbmRlZENhY2hlLnNldChjb2xsYXBzaWJsZUl0ZW0uZ2V0SWQoKSwgY29sbGFwc2libGVJdGVtLmlzRXhwYW5kZWQoKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIHByaXZhdGUgX29uV29ya3NwYWNlQ2hhbmdlKGV2ZW50OiBhbnkpIHtcbiAgICAgICAgaWYgKGV2ZW50LnR5cGUgPT09IEJsb2NrbHkuRXZlbnRzLlRPT0xCT1hfSVRFTV9TRUxFQ1QpIHtcbiAgICAgICAgICAgIHRoaXMuX3N0b3JlRXhwYW5kZWRTdGF0ZSgpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBfY29tcGFyZShzdHIxOiBzdHJpbmcsIHN0cjI6IHN0cmluZyk6IGJvb2xlYW4ge1xuICAgICAgICBpZiAodHlwZW9mIHN0cjEgPT09ICdzdHJpbmcnICYmIHR5cGVvZiBzdHIyID09PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgc3RyMSA9IHRoaXMuX3ByZXBhcmVTdHJpbmcoc3RyMSk7XG4gICAgICAgICAgICBzdHIyID0gdGhpcy5fcHJlcGFyZVN0cmluZyhzdHIyKTtcbiAgICAgICAgICAgIGlmIChzdHIxLmxlbmd0aCA+IDAgJiYgc3RyMi5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgYXJyYXkxOiBzdHJpbmdbXSA9IHN0cjEuc3BsaXQoJ18nKTtcbiAgICAgICAgICAgICAgICBjb25zdCBhcnJheTI6IHN0cmluZ1tdID0gc3RyMi5zcGxpdCgnXycpO1xuICAgICAgICAgICAgICAgIGZvciAobGV0IGkxID0gMDsgaTEgPCBhcnJheTEubGVuZ3RoOyBpMSsrKSB7XG4gICAgICAgICAgICAgICAgICAgIGZvciAobGV0IGkyID0gMDsgaTIgPCBhcnJheTIubGVuZ3RoOyBpMisrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoYXJyYXkyW2kyXS5zdGFydHNXaXRoKGFycmF5MVtpMV0pKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIHByaXZhdGUgX3ByZXBhcmVTdHJpbmcoc3RyKTogc3RyaW5nIHtcbiAgICAgICAgc3RyID0gdGhpcy5fYnJlYWtVcENhbWVsQ2FzZShzdHIpO1xuICAgICAgICBzdHIgPSBzdHIudG9Mb3dlckNhc2UoKS50cmltKCk7XG4gICAgICAgIHJldHVybiB0aGlzLl9yZXBsYWNlV2hpdGVzcGFjZVdpdGhVbmRlcnNjb3JlKHN0cik7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBfYnJlYWtVcENhbWVsQ2FzZShzdHIpOiBzdHJpbmcge1xuICAgICAgICByZXR1cm4gc3RyLnJlcGxhY2UoLyhbQS1aXSkvZywgJyAkMScpO1xuICAgIH1cblxuICAgIHByaXZhdGUgX3JlcGxhY2VXaGl0ZXNwYWNlV2l0aFVuZGVyc2NvcmUoc3RyKTogc3RyaW5nIHtcbiAgICAgICAgcmV0dXJuIHN0ci5yZXBsYWNlKC9cXHMrL2csICdfJyk7XG4gICAgfVxufVxuIl19